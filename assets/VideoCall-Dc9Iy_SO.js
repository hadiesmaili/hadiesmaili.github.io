import{r as l,j as e,H as y}from"./index-CiAHWKtq.js";const C=()=>{const s=l.useRef(null),o=l.useRef(null),[h,p]=l.useState(""),[u,v]=l.useState(""),[i,f]=l.useState("disconnected"),r=l.useRef(void 0),x={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},j=async()=>{try{const t=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});s.current&&(s.current.srcObject=t),r.current=new RTCPeerConnection(x),t.getTracks().forEach(n=>{var c;return(c=r.current)==null?void 0:c.addTrack(n,t)}),r.current.onicecandidate=({candidate:n})=>{n&&localStorage.setItem("ice-candidates",JSON.stringify(n))},r.current.ontrack=n=>{o.current&&(o.current.srcObject=n.streams[0])};const d=await r.current.createOffer();await r.current.setLocalDescription(d);const a=w();p(a),localStorage.setItem(`offer-${a}`,JSON.stringify(d)),f("waiting")}catch(t){console.error("Error starting call:",t)}},b=async()=>{try{const t=localStorage.getItem(`offer-${u}`);if(!t){alert("کد اتصال معتبر نیست");return}const d=JSON.parse(t),a=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});s.current&&(s.current.srcObject=a),r.current=new RTCPeerConnection(x),a.getTracks().forEach(c=>{var g;return(g=r.current)==null?void 0:g.addTrack(c,a)}),r.current.onicecandidate=({candidate:c})=>{c&&localStorage.setItem("ice-candidates",JSON.stringify(c))},r.current.ontrack=c=>{o.current&&(o.current.srcObject=c.streams[0])},await r.current.setRemoteDescription(d);const n=await r.current.createAnswer();await r.current.setLocalDescription(n),localStorage.setItem(`answer-${u}`,JSON.stringify(n)),f("connected")}catch(t){console.error("Error joining call:",t)}},m=()=>{var t;(t=r.current)==null||t.close(),f("disconnected"),s.current&&(s.current.srcObject=null),o.current&&(o.current.srcObject=null)},w=()=>Math.random().toString(36).substr(2,9);return e.jsx("div",{className:"relative flex size-full min-h-screen flex-col bg-primary group/design-root overflow-x-hidden",style:{fontSize:"16px"},children:e.jsxs("div",{className:"flex h-full grow flex-col",children:[e.jsx(y,{}),e.jsxs("div",{className:"relative flex-grow flex flex-col md:flex-row p-4 gap-4",children:[e.jsxs("div",{className:"relative flex-1 bg-black rounded-3xl overflow-hidden shadow-lg",children:[e.jsx("video",{ref:o,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover bg-gray-700"}),i!=="connected"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-gray-400 text-lg",children:"ویدیو طرف مقابل"})]}),e.jsx("div",{className:"absolute top-10 end-10 w-fit h-fit",children:e.jsxs("div",{className:"relative w-48 h-36 md:w-64 md:h-48 rounded-3xl overflow-hidden shadow-lg bg-black self-start",children:[e.jsx("video",{ref:s,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover"}),i==="disconnected"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-gray-400 text-sm",children:"ویدیو شما"})]})})]}),e.jsxs("footer",{className:"p-4 bg-[var(--color-gray-darker)] flex flex-col md:flex-row items-center justify-between gap-4",children:[i==="disconnected"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:j,className:"bg-green-600 hover:bg-[var(--color-accept)] transition rounded-full px-6 py-3 font-semibold shadow-md",children:"ایجاد تماس جدید"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"کد اتصال را وارد کنید",value:u,onChange:t=>v(t.target.value),className:"px-4 py-2 rounded-full text-[var(--color-text)] placeholder:text-[var(--color-text)] ring-2 ring-[var(--color-link)]"}),e.jsx("button",{onClick:b,className:"bg-[var(--color-link)] hover:opacity-85 transition rounded-full px-6 py-3 font-semibold shadow-md",children:"وصل شدن به تماس"})]})]}),i==="waiting"&&e.jsxs("div",{className:"flex flex-col items-center gap-2 w-full md:w-auto",children:[e.jsxs("p",{className:"text-center text-[var(--color-accept)] font-mono text-lg",children:["کد اتصال شما:"," ",e.jsx("span",{className:"font-bold",children:h})]}),e.jsx("button",{onClick:m,className:"bg-red-600 hover:bg-red-700 transition rounded-full px-6 py-3 font-semibold shadow-md",children:"لغو تماس"})]}),i==="connected"&&e.jsx("button",{onClick:m,className:"bg-red-600 hover:bg-red-700 transition rounded-full px-6 py-3 font-semibold shadow-md",children:"قطع تماس"})]})]})})};export{C as default};
