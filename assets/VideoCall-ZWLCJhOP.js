import{r as s,j as e,H as I}from"./index-Dg82kvaB.js";function O(){const[m,p]=s.useState(""),[d,x]=s.useState(""),[c,l]=s.useState("disconnected"),[w,j]=s.useState([]),[f,N]=s.useState([]),[g,h]=s.useState(""),[b,P]=s.useState(""),i=s.useRef(null),u=s.useRef(null),t=s.useRef(null);s.useEffect(()=>{const r=Math.random().toString(36).substring(2,10);p(r);const n=new URLSearchParams(window.location.search).get("peer");return n&&x(n),()=>{t.current&&t.current.close()}},[]);const v=()=>{const r=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]});r.onicecandidate=a=>{if(a.candidate){const n=JSON.stringify(a.candidate);j(o=>[...o,n])}},r.ontrack=a=>{u.current&&(u.current.srcObject=a.streams[0])},t.current=r},y=async()=>{l("starting"),v();try{const r=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});i.current&&(i.current.srcObject=r),r.getTracks().forEach(n=>{var o;(o=t.current)==null||o.addTrack(n,r)});const a=await t.current.createOffer();await t.current.setLocalDescription(a),h(JSON.stringify(a)),l("waiting-for-answer")}catch(r){console.error("Error starting call:",r),l("error")}},C=async()=>{if(!(!t.current||!b)){l("answering");try{const r=JSON.parse(b);await t.current.setRemoteDescription(r),f.forEach(a=>{var n;(n=t.current)==null||n.addIceCandidate(JSON.parse(a))}),l("connected")}catch(r){console.error("Error answering call:",r),l("error")}}},S=()=>{const r=`${window.location.origin}${window.location.pathname}?peer=${m}`;navigator.clipboard.writeText(r),alert(`لینک دعوت کپی شد: ${r}`)};return e.jsx("div",{className:"relative flex size-full min-h-screen flex-col bg-primary group/design-root overflow-x-hidden",style:{fontSize:"16px"},children:e.jsxs("div",{className:"flex h-full grow flex-col",children:[e.jsx(I,{}),e.jsxs("div",{className:"flex flex-col items-center justify-center p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"تماس ویدیویی"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 w-full max-w-4xl",children:[e.jsxs("div",{className:"flex-1 bg-gray-800 rounded-lg overflow-hidden",children:[e.jsx("video",{ref:i,autoPlay:!0,muted:!0,className:"w-full h-auto max-h-[400px]"}),e.jsxs("div",{className:"p-2 bg-gray-900 text-white",children:["شما (ID: ",m,")"]})]}),e.jsxs("div",{className:"flex-1 bg-gray-800 rounded-lg overflow-hidden",children:[e.jsx("video",{ref:u,autoPlay:!0,className:"w-full h-auto max-h-[400px]"}),e.jsx("div",{className:"p-2 bg-gray-900 text-white",children:c==="connected"?`مخاطب (ID: ${d})`:"در انتظار اتصال..."})]})]}),e.jsxs("div",{className:"mt-6 w-full max-w-2xl bg-gray-100 p-4 rounded-lg",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 font-medium",children:"کد مخاطب:"}),e.jsx("input",{type:"text",value:d,onChange:r=>x(r.target.value),className:"w-full p-2 border rounded",placeholder:"کد مخاطب را وارد کنید"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[e.jsx("button",{onClick:y,disabled:c!=="disconnected",className:"bg-blue-500 text-white px-4 py-2 rounded disabled:bg-gray-400",children:"شروع تماس"}),e.jsx("button",{onClick:S,className:"bg-green-500 text-white px-4 py-2 rounded",children:"کپی لینک دعوت"})]}),c==="waiting-for-answer"&&e.jsxs("div",{className:"mt-4 p-3 bg-yellow-100 rounded",children:[e.jsx("h3",{className:"font-bold mb-2",children:"اطلاعات تماس شما:"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block mb-1",children:"SDP Offer:"}),e.jsx("textarea",{value:g,readOnly:!0,className:"w-full p-2 border rounded bg-gray-50",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"ICE Candidates:"}),e.jsx("textarea",{value:w.join(`

`),readOnly:!0,className:"w-full p-2 border rounded bg-gray-50",rows:3})]}),e.jsx("p",{className:"mt-2 text-sm",children:"این اطلاعات را برای مخاطب خود ارسال کنید تا آنها را در بخش زیر وارد کند."})]}),c==="disconnected"&&d&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded",children:[e.jsx("h3",{className:"font-bold mb-2",children:"اطلاعات تماس مخاطب:"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block mb-1",children:"SDP Offer:"}),e.jsx("textarea",{value:g,onChange:r=>h(r.target.value),className:"w-full p-2 border rounded",rows:3,placeholder:"SDP Offer مخاطب را اینجا وارد کنید"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block mb-1",children:"ICE Candidates:"}),e.jsx("textarea",{value:f.join(`

`),onChange:r=>N(r.target.value.split(`

`)),className:"w-full p-2 border rounded",rows:3,placeholder:"ICE Candidates مخاطب را اینجا وارد کنید (هر candidate در یک خط)"})]}),e.jsx("button",{onClick:C,className:"bg-purple-500 text-white px-4 py-2 rounded mt-2",children:"پاسخ به تماس"})]}),e.jsxs("div",{className:"mt-4 p-2 bg-gray-200 rounded",children:["وضعیت:"," ",{disconnected:"قطع",starting:"در حال شروع تماس...","waiting-for-answer":"در انتظار پاسخ مخاطب...",answering:"در حال پاسخ به تماس...",connected:"متصل",error:"خطا در اتصال"}[c]]})]})]})]})})}export{O as default};
