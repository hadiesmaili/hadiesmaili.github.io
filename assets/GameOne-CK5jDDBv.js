import{j as t,c as B,u as U,r as N,H as X}from"./index-DknMN4Vk.js";function H({card:d,className:n,isShow:l=!1,onClick:x,isPlayable:f=!1}){return t.jsx("div",{className:B("w-12 h-16 text-md font-bold flex items-start justify-start p-1.5 rounded border","border-neutral-500  shadow-xl ring-1 ring-neutral-500","bg-contain bg-no-repeat bg-center transition-all duration-200",{"cursor-pointer hover:z-10 hover:scale-110":f,"ring-2 ring-yellow-400":f,"opacity-95":!f&&l},n),style:{backgroundImage:`url("/assets/images/games/cards/${l&&d?d.image:"b.svg"}")`},onClick:f?x:void 0})}function Z({gameLog:d,onClose:n}){return t.jsxs("div",{dir:"rtl",className:"absolute top-4 left-4  bottom-4 bg-black bg-opacity-50 text-white p-2 max-h-[90vh] rounded-2xl overflow-y-auto text-sm max-w-96 z-20",children:[t.jsxs("div",{className:"flex justify-between items-center gap-x-4 pe-2",children:[t.jsx("h3",{className:"font-bold mb-1",children:"تاریچه بازی:"}),t.jsx("button",{onClick:n,className:"text-white text-2xl cursor-pointer w-6 h-6 bg-[var(--color-shadow)] rounded-full",children:"×"})]}),d.slice().reverse().map((l,x)=>t.jsxs("div",{className:"border-b border-gray-600 py-1",children:[t.jsx("div",{className:"text-xs text-gray-300",children:l.timestamp.toLocaleTimeString()}),l.player&&t.jsxs("span",{className:"text-yellow-300",children:[l.player,": "]}),l.action,l.details&&t.jsx("div",{className:"text-xs text-gray-400",children:l.details}),t.jsx("div",{className:"flex gap-x-2 justify-end ",children:Array.isArray(l.experimentImage)&&l.experimentImage.map(f=>f?t.jsx("div",{className:"w-10 h-14 rounded bg-contain bg-no-repeat bg-center transition-all duration-200",style:{backgroundImage:`url("/assets/images/games/cards/${f.image||"b.svg"}")`}},f.image):null)})]},x))]})}function ee({onClose:d}){const{t:n}=U(),l=x=>{x.target.checked?localStorage.setItem("licenses","true"):localStorage.removeItem("licenses")};return t.jsx("div",{className:"fixed top-0 left-0 z-50 flex h-full w-full items-center justify-center bg-[var(--color-bg)]/80  ",children:t.jsx("div",{className:"relative flex size-full h-screen sm:h-fit py-10 max-h-screen sm:max-h-[90vh] overflow-x-hidden w-full sm:w-[90vw] lg:w-fit lg:px-40 flex-col bg-[var(--color-bg)] group/design-root  sm:rounded-2xl",children:t.jsx("div",{className:" flex h-full grow flex-col",children:t.jsx("div",{className:"px-4 flex flex-1 justify-center py-5",children:t.jsxs("div",{className:" flex flex-col w-[512px] max-w-[512px] py-5 xl:max-w-[960px] flex-1 ",children:[t.jsx("h2",{className:"text-[var(--color-text)] tracking-light text-[28px] font-bold leading-tight px-4 text-center pb-3 sm:pt-5",children:n("GameOne.license.title")}),t.jsx("h3",{className:"text-[var(--color-text)] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4",children:n("GameOne.rules.starting")}),t.jsx("p",{className:"text-[var(--color-text)] text-base font-normal leading-normal pb-3 pt-1 px-4",children:n("GameOne.rules.starting.description")}),t.jsx("h3",{className:"text-[var(--color-text)] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4",children:n("GameOne.rules.gameplay")}),t.jsx("p",{className:"text-[var(--color-text)] text-base font-normal leading-normal pb-3 pt-1 px-4",children:n("GameOne.rules.gameplay.description")}),t.jsx("h3",{className:"text-[var(--color-text)] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4",children:n("GameOne.rules.scoring")}),t.jsx("p",{className:"text-[var(--color-text)] text-base font-normal leading-normal pb-3 pt-1 px-4 flex flex-col gap-2 whitespace-pre-line",children:n("GameOne.rules.scoring.list")}),t.jsx("div",{className:"px-4",children:t.jsxs("label",{className:"flex gap-x-3 py-3 flex-row",children:[t.jsx("input",{type:"checkbox",onChange:l,className:"h-5 w-5 rounded border-[var(--color-accept)] border-2 bg-transparent text-[var(--color-accept)] checked:bg-[var(--color-accept)] checked:border-[var(--color-accept)] checked:bg-[image:--checkbox-tick-svg] focus:ring-0 focus:ring-offset-0 focus:border-[var(--color-accept)] focus:outline-none"}),t.jsx("p",{className:"text-[var(--color-text)] text-base font-normal leading-normal",children:n("GameOne.ui.dontShowThisAgain")})]})}),t.jsx("div",{className:"flex px-4 py-3",onClick:d,children:t.jsx("button",{className:"flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 flex-1 bg-[var(--color-accept)] text-[var(--color-text)] text-sm font-bold leading-normal tracking-[0.015em] hover:opacity-75",children:t.jsx("span",{className:"truncate",children:n("GameOne.ui.close")})})})]})})})})})}function te(){const d=["c","d","h","s"],n=["1","2","3","4","5","6","7","8","9","10","j","q","k"],l=["Ace","2","3","4","5","6","7","8","9","10","Jack","Queen","King"],x=[1,2,3,4,5,6,7,8,9,10,10,10,10],f=[];return d.forEach(h=>{n.forEach((S,a)=>{f.push({value:S,suit:h,image:`${S}${h}.svg`,name:`${l[a]} of ${h}`,id:`${S}${h}-${Math.random().toString(36).substr(2,9)}`,numericValue:x[a]??0})})}),f.filter(Boolean)}function se(d){const n=[...d];for(let l=n.length-1;l>0;l--){const x=Math.floor(Math.random()*(l+1));[n[l],n[x]]=[n[x],n[l]]}return n}const M=d=>!!d&&!!d.id&&!!d.name;function ne(){const[d,n]=N.useState("waiting"),[l,x]=N.useState([]),[f,h]=N.useState([]),[S,a]=N.useState(0),[C,$]=N.useState([]),[V,I]=N.useState(!1),[O,E]=N.useState([]),T=(u,i,r,m,o)=>{E(b=>[...b,{action:u,player:i,card:r,details:m,timestamp:new Date,experimentImage:o}])},A=()=>{const i=se(te()).filter(M),r=[],m=[];for(let j=0;j<4;j++){const k=i.slice(j*4,(j+1)*4).filter(M);r.push(k)}const o=i.slice(16,20).filter(M);if(m.push(...o),m==null?void 0:m.some(j=>(j==null?void 0:j.value)==="j")){const j=m==null?void 0:m.findIndex(P=>(P==null?void 0:P.value)==="j"),k=i[20];m[j]=k,T("سرباز در وسط زمین بود و با کارت دیگری جایگزین شد","سیستم",k==null?void 0:k.name)}x(i.slice(20)),$(m),h([{id:0,name:"you",cards:r[0],isHuman:!0,score:0,collectedCards:[]},{id:1,name:"Nazi",cards:r[1],isHuman:!1,score:0,collectedCards:[]},{id:2,name:"Amir",cards:r[2],isHuman:!1,score:0,collectedCards:[]},{id:3,name:"Yasi",cards:r[3],isHuman:!1,score:0,collectedCards:[]}]);const D=0;a(D),T(`بازی شروع شد. شروع کننده: ${["شما","حریف 1","حریف 2","حریف 3"][D]}`,"سیستم"),n("playing")};N.useEffect(()=>{A()},[]);const R=()=>{I(!V)},g=u=>["j","q","k"].includes(u.value.toLowerCase());return{gameState:d,deck:l,players:f,currentPlayer:S,centerCards:C,showLogs:V,gameLog:O,setPlayers:h,setCenterCards:$,setDeck:x,setCurrentPlayer:a,setGameState:n,setGameLog:E,addLog:T,initGame:A,handleOpenLogs:R,canCollectCards:(u,i)=>{if(!u||!i||i.length===0)return{canCollect:!1,cardsToCollect:[]};const r=i.filter(M),m=u.numericValue;if(u.value.toLowerCase()==="j"){const o=r.filter(b=>!g(b));return o.length>0?{canCollect:!0,cardsToCollect:[...o]}:{canCollect:!1,cardsToCollect:[]}}if(g(u)){const o=r.find(b=>g(b)&&b.value===u.value);if(o)return{canCollect:!0,cardsToCollect:[o]}}if(!g(u)){for(const o of r)if(o&&!g(o)&&m+o.numericValue===11)return{canCollect:!0,cardsToCollect:[o]};for(let o=0;o<r.length;o++)if(!g(r[o]))for(let b=o+1;b<r.length;b++){if(g(r[b]))continue;if(m+r[o].numericValue+r[b].numericValue===11)return{canCollect:!0,cardsToCollect:[r[o],r[b]]}}}return{canCollect:!1,cardsToCollect:[]}},startNewRound:()=>{const u=[];for(let i=0;i<4;i++)u.push(l.slice(i*4,(i+1)*4).filter(M));x(i=>i.slice(16)),h(i=>i.map((r,m)=>({...r,cards:u[m]}))),T("دور جدید شروع شد. کارت‌های جدید توزیع شد","سیستم"),a(0)}}}function ae(){var P,J,K,Q,W;const[d,n]=N.useState(null),[l,x]=N.useState(!1),{t:f}=U(),{gameState:h,deck:S,players:a,currentPlayer:C,centerCards:$,showLogs:V,gameLog:I,setPlayers:O,setCenterCards:E,setDeck:T,setCurrentPlayer:A,setGameState:R,addLog:g,initGame:_,handleOpenLogs:q,canCollectCards:u,startNewRound:i}=ne();N.useEffect(()=>{_(),r()},[]),N.useEffect(()=>{C!==0&&h==="playing"&&D()},[C,h]),N.useEffect(()=>{h==="playing"&&(()=>{a.every(e=>e.cards.length===0)&&(S.length>=16?i():o())})()},[a,S,h]);const r=()=>{localStorage.getItem("licenses")||x(!0)},m=(s,e,c)=>{var L,z,Y,F;if(!e||!c||c.some(p=>!p)){g("خطا در جمع‌آوری کارت‌ها - کارت نامعتبر","سیستم");return}const v=[...$],G=[...c,e].filter(p=>p!==void 0);c.forEach(p=>{if(p&&p.id){const w=v.findIndex(y=>(y==null?void 0:y.id)===p.id);w!==-1&&v.splice(w,1)}}),O(p=>p.map(w=>w.id===s?{...w,cards:w.cards.filter(y=>(y==null?void 0:y.id)!==(e==null?void 0:e.id)),collectedCards:[...w.collectedCards,...G.filter(y=>y!==void 0)]}:w)),E(v.filter(p=>p!==void 0)),v.length===0&&(g(`بازیکن ${((L=a[s])==null?void 0:L.name)||"ناشناس"} زمین را خالی کرد و سور زد!`,((z=a[s])==null?void 0:z.name)||"سیستم","",""),O(p=>p.map(w=>w.id===s?{...w,score:w.score+5}:w))),g(`بازیکن ${((Y=a[s])==null?void 0:Y.name)||"ناشناس"} کارت ${(e==null?void 0:e.name)||"ناشناس"} را بازی کرد و ${G.length} کارت جمع کرد`,((F=a[s])==null?void 0:F.name)||"سیستم",(e==null?void 0:e.name)||"ناشناس",`جمع کارت‌ها: ${G.map(p=>(p==null?void 0:p.name)||"ناشناس").join(", ")}`,G),n(s),k()},o=()=>{d!==null&&$.length>0&&(O(e=>e.map(c=>c.id===d?{...c,collectedCards:[...c.collectedCards,...$],score:c.score+$.length}:c)),g(`کارت‌های باقی‌مانده وسط زمین به بازیکن ${a[d].name} داده شد`,"سیستم")),E([]),R("gameOver"),g("بازی به پایان رسید!","سیستم");const s=a.reduce((e,c)=>c.score>e.score?c:e);g(`بازیکن ${s.name} برنده بازی با ${s.score} امتیاز است!`,"سیستم"),alert(`بازیکن ${s.name} برنده بازی با ${s.score} امتیاز است!`)},b=s=>{if(C!==0||h!=="playing")return;const{canCollect:e,cardsToCollect:c}=u(s,$);e?m(0,s,c):j(0,s)},D=()=>{C===0||h!=="playing"||setTimeout(()=>{const e=a[C].cards.filter(v=>v);if(e.length===0){k();return}for(const v of e){const{canCollect:G,cardsToCollect:L}=u(v,$);if(G){m(C,v,L);return}}const c=e[Math.floor(Math.random()*e.length)];c?j(C,c):k()},1e3)},j=(s,e)=>{var c,v;if(!e||!e.id){g("خطا: کارت نامعتبر برای بازی","سیستم"),k();return}O(G=>G.map(L=>L.id===s?{...L,cards:L.cards.filter(z=>(z==null?void 0:z.id)!==e.id)}:L)),E(G=>[...G,e]),g(`بازیکن ${((c=a[s])==null?void 0:c.name)||"ناشناس"} کارت ${e.name} را به وسط زمین انداخت`,((v=a[s])==null?void 0:v.name)||"سیستم",e.name),k()},k=()=>{if(a.every(s=>s.cards.length===0||s.cards.every(e=>!e))){if(S.length<16){o();return}if(S.length>=16){const s=[];for(let e=0;e<4;e++){const c=S.slice(e*4,(e+1)*4).filter(v=>v);s.push(c)}T(e=>[...e.slice(16)]),O(e=>e.map((c,v)=>({...c,cards:s[v]||[]}))),g("دور جدید شروع شد. کارت‌های جدید توزیع شد.","سیستم")}else o()}A(s=>(s+1)%4)};return t.jsx("div",{className:"relative flex size-full min-h-screen flex-col bg-primary group/design-root overflow-x-hidden",style:{fontSize:"16px"},children:t.jsxs("div",{className:"flex h-full grow flex-col ",children:[t.jsx(X,{}),t.jsxs("div",{className:"relative w-full flex-1 flex flex-col items-center justify-between py-8 rounded-lg md:rounded-2xl bg-gradient-to-tr from-indigo-800 from-10% via-sky-700 via-40% to-emerald-600 to-80%",children:[t.jsx("button",{className:"absolute top-4 left-4 cursor-pointer",onClick:q,children:"logs"}),t.jsxs("div",{className:"hidden sm:inline-block absolute top-4 right-4 text-white mt-20 md:mt-0",children:[t.jsx("h3",{className:"text-lg font-bold mb-2",children:f("Global.score")}),t.jsx("div",{className:"grid grid-cols-1 gap-2 ",children:a.map((s,e)=>t.jsxs("div",{className:B("flex items-center justify-between gap-3 text-xs",C===e?"font-bold text-yellow-500":""),children:[t.jsxs("div",{className:"",children:[f("GameOne.collectedCards"),":"," ",s.collectedCards.length]}),s.name,": ",s.score]},e))})]}),t.jsx("div",{className:"flex -space-x-4 min-h-16",children:(P=a[2])==null?void 0:P.cards.map((s,e)=>t.jsx(H,{className:"rotate-180",isShow:!1},`top-${e}`))}),t.jsxs("div",{className:"relative flex justify-center items-center h-32 w-full",children:[t.jsx("div",{className:"absolute flex flex-wrap justify-center gap-2 z-10 max-w-lg",children:$.map((s,e)=>t.jsx(H,{card:s,isShow:!0,className:"h-20 w-14"},`center-${e}`))}),t.jsxs("div",{className:"absolute bottom-0 text-white font-bold",children:[f("Global.turn"),": ",(J=a[C])==null?void 0:J.name]})]}),t.jsxs("div",{className:"absolute top-1/3 md:top-1/2 flex justify-between w-full px-12 -translate-y-1/2",children:[t.jsx("div",{className:"flex flex-col items-end -space-y-12 min-w-12",children:(K=a[1])==null?void 0:K.cards.map((s,e)=>t.jsx(H,{className:"rotate-90",isShow:!1},`left-${e}`))}),t.jsx("div",{className:"flex flex-col items-start -space-y-12 min-w-12",children:(Q=a[3])==null?void 0:Q.cards.map((s,e)=>t.jsx(H,{className:"rotate-90",isShow:!1},`right-${e}`))})]}),t.jsx("div",{className:"flex -space-x-4",children:(W=a[0])==null?void 0:W.cards.filter(s=>s!==void 0).map(s=>{const{canCollect:e}=u(s,$);return t.jsx(H,{card:s,className:B("h-20 w-14 hover:scale-125",{"ring-2 ring-green-500":e}),isShow:!0,isPlayable:C===0&&h==="playing",onClick:()=>b(s)},`hand-${s==null?void 0:s.id}`)})}),h==="gameOver"&&t.jsx("button",{className:"absolute bottom-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",onClick:_,children:f("Global.playAgain")}),V&&t.jsx(Z,{gameLog:I,onClose:q}),l&&t.jsx(ee,{onClose:()=>x(!1)})]})]})})}export{ae as default};
